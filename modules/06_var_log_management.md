# Module 6: Linux System Log Management â€“ `/var/log`

The `/var/log` directory is one of the most critical locations in a Linux filesystem. It serves as the central repository for all system logs, providing a detailed record of events, errors, and activities. For system administrators, developers, and security professionals, mastering the use of `/var/log` is essential for troubleshooting, monitoring, and maintaining system health and security.

### Table of Contents

1.  [Purpose of /var/log](#purpose-of-varlog)
2.  [Common Log Files in /var/log](#common-log-files-in-varlog)
3.  [Viewing and Managing Logs](#viewing-and-managing-logs)
4.  [Log Rotation with logrotate](#log-rotation-with-logrotate)
5.  [Best Practices for Log Management](#best-practices-for-log-management)
6.  [Conclusion](#conclusion)

---

## Purpose of `/var/log`

The primary purpose of `/var/log` is to store a variety of log files generated by the kernel, services, applications, and the system itself. These logs are invaluable for:

*   **Troubleshooting:** Diagnosing system issues, failed services, or hardware problems.
*   **Security Monitoring:** Tracking login attempts, failed passwords, and suspicious activity.
*   **System Auditing:** Reviewing system events, updates, and service behavior.
*   **Forensics:** Investigating security breaches or unauthorized access.

System administrators rely on `/var/log` to keep systems running smoothly and securely.

---

## Common Log Files in `/var/log`

The `/var/log` directory contains many different log files, each with a specific purpose. Here is a table of some of the most important ones you will encounter.

| File | Purpose | Example Use Case | Command to View |
| :--- | :--- | :--- | :--- |
| `/var/log/auth.log` | Records authentication events like login attempts and sudo usage. | Monitoring failed login attempts. | `sudo tail -f /var/log/auth.log` |
| `/var/log/syslog` or `/var/log/messages` | General system messages and service logs. | Debugging network issues or service failures. | `sudo tail -f /var/log/syslog` |
| `/var/log/kern.log` | Kernel-specific messages and hardware-related logs. | Checking USB or driver errors. | `sudo tail -f /var/log/kern.log` |
| `/var/log/dmesg` | Kernel ring buffer messages (boot-time hardware detection). | Diagnosing boot-time hardware issues. | `dmesg \| less` |
| `/var/log/boot.log` | Logs of system services and processes during boot. | Reviewing startup behavior. | `cat /var/log/boot.log` |
| `/var/log/wtmp` | Binary file storing successful login history. | Viewing login history with `last`. | `last` |
| `/var/log/btmp` | Binary file storing failed login attempts. | Viewing failed logins with `lastb`. | `sudo lastb` |
| `/var/log/faillog` | Tracks number of failed login attempts per user. | Investigating brute-force attacks. | `faillog` |
| `/var/log/lastlog` | Shows last login time for each user. | Auditing user activity. | `lastlog` |
| `/var/log/apt/history.log` (Debian/Ubuntu only) | Records package installation, update, and removal history. | Tracking software changes. | `cat /var/log/apt/history.log` |

---

## Viewing and Managing Logs

Linux provides several tools to view and manage log files:

### Common Commands

| Command | Description | Example |
| :--- | :--- | :--- |
| `tail -f` | View log in real time | `sudo tail -f /var/log/auth.log` |
| `cat` | View full content of a log | `cat /var/log/boot.log` |
| `less` | Scroll through large logs | `dmesg \| less` |
| `grep` | Search for specific patterns | `grep "usb" /var/log/kern.log` |
| `last` | View successful login history | `last` |
| `lastb` | View failed login attempts | `sudo lastb` |
| `faillog` | View failed login counts | `faillog` |
| `lastlog` | View last login time per user | `lastlog` |

---

### Detailed Usage Examples

Logs can be simple text files or binary files. The following commands are essential for viewing log content from the terminal.

### 1. Viewing Real-Time Logs (`tail -f`)

The `tail` command with the `-f` (follow) option is a crucial tool for real-time monitoring. It displays the last few lines of a file and continues to show new lines as they are added.

**Example:**
To monitor login attempts as they happen:
```bash
sudo tail -f /var/log/auth.log
```
**Output Example:**
```text
Failed password for root from 192.168.1.10 port 22 ssh2
```
This line indicates a failed password attempt for the `root` user from a specific IP address.

### 2. Viewing a Full Log (`cat`, `less`)

The `cat` command displays the entire content of a log file, while `less` is better for scrolling through very large files.

**Examples:**
*   `cat` for small logs:
    ```bash
    cat /var/log/boot.log
    ```
    Output:
    ```text
    Started GNOME Display Manager.
    ```
*   `less` for large logs:
    ```bash
    dmesg | less
    ```

### 3. Searching Logs (`grep`)

`grep` is used to search for a specific pattern or keyword within log files.

**Example:**
To find all `usb` related entries in the kernel log:
```bash
sudo grep "usb" /var/log/kern.log
```
**Output Example:**
```text
usb 2-1: New USB device found
```

### 4. Viewing Binary Logs (`last`, `lastb`, `faillog`, `lastlog`)

These specific commands are used to view special binary log files.

| Command    | Purpose                               |
| :--- | :--- |
| `last`     | Shows successful login history from `/var/log/wtmp`. |
| `sudo lastb` | Shows failed login attempts from `/var/log/btmp`. |
| `faillog`  | Tracks failed login attempts per user from `/var/log/faillog`. |
| `lastlog`  | Shows the last login time for all users from `/var/log/lastlog`. |

---

## Log Rotation with `logrotate`

Log files can grow large over time. Linux uses `logrotate` to compress, rotate, and delete old logs automatically.

**Why It's Needed:**
*   Prevents disk space exhaustion.
*   Keeps logs manageable and organized.
*   Archives old logs for auditing or investigation.

**Configuration Files:**
*   Global configuration: `/etc/logrotate.conf`
*   Service-specific configurations: `/etc/logrotate.d/`

---

## Best Practices for Log Management

1.  **Monitor Regularly:** Periodically check your logs, especially `/var/log/syslog` and `/var/log/auth.log`, to spot unusual activity.
2.  **Secure Log Files:** Restrict permissions to prevent unauthorized access or modification. Many logs require `sudo` to view, which helps maintain security.
3.  **Centralize Logs (Optional):** For larger environments, use tools like `rsyslog` or `logstash` to send logs to a central server for easier management and auditing.
4.  **Archive Old Logs:** Use `logrotate` to compress and archive logs older than a set number of days.
5.  **Automate Alerts:** Tools like `fail2ban` can automatically scan log files and take action (e.g., blocking an IP address) in response to repeated failed logins.

---

## Conclusion

The `/var/log` directory is essential for maintaining a secure, stable, and well-audited Linux system. By understanding what each log file does and how to use the correct commands to view them, you'll be better equipped to manage and secure your Linux environment effectively.
